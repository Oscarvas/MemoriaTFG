%---------------------------------------------------------------------
%
%                          Capítulo 13
%
%---------------------------------------------------------------------
\chapter{Trabajo Individual}

\begin{FraseCelebre}
\begin{Frase}
\end{Frase}
\begin{Fuente}
\end{Fuente}
\end{FraseCelebre}

Antes de empezar es importante señalar que el trabajo hecho para el desarrollo de esta investigación ha sido realmente extenso. Si bien hay ciertas partes que se pueden dividir en tareas que ha realizado de manera individual cada uno de los miembros, es importante señalar que sin la ayuda de todos no se habrían conseguido cotas tan altas. Las reuniones de contenidos, opiniones, revisiones y modificaciones son difíciles de detallar para explicar de manera precisa donde acaba la aportación de un integrante y empieza la de otro. A continuación se procederá a intentar explicar de la mejor manera posible las aportaciones individuales de cada uno, teniendo siempre en cuenta esta premisa.

\section{Trabajo realizado por Juan Orellana Quemada}
Para empezar mi aportación a esta investigación me documente bien sobre la misma, pues nunca había trabajado ni con generadores de historias ni con agentes inteligentes ni con un planificador. Para ello, y como se partía de una investigación anterior, tuve que leer profundamente la memoria de la misma así como los artículos referenciados en ella, haciendo especial hincapié en aquellos que nos proporcionaba nuestro director del proyecto.

A partir de aquí, me volqué en el diseño de nuestro generador de historias. Como no teníamos muy claro que queríamos hacer en un principio, participé activamente en el \textit{brainstorming} inicial, y poco a poco conseguimos buenas ideas junto a la ayuda de nuestro tutor, detalladas mas extensamente en el Capitulo de \ref{cap:Objetivos}. 

Como tampoco podíamos paralizar la implementación, en cuanto tuvimos un objetivo claro, en este caso el de los personajes con múltiples objetivos, realice las primeras pruebas de modificaciones en la aplicación, hasta que al no conseguir avances hubo que rehacerla, tal y como se detalla en el Capítulo \ref{cap:PrimerosPasos}. En concreto todas las pruebas del villano fueron realizadas por mi.

Mientras intentaba esto, también desarrollé el primer prototipo de memoria de la aplicación, de forma que aquellas partes en las que el diseño era claro iban tomando forma poco a poco dando lugar a unos objetivos claros hacia los que encaminar nuestro trabajo. Sin embargo hablaré del resto de mi aportación a la memoria más tarde.

Cuando empezó la implementación de nuestra aplicación definitiva, aprendí de mi compañero Oscar los fundamentos de la misma, pues él llevaba la voz cantante en este aspecto.
Cuando adquirí el suficiente conocimiento, implementé la primera beta de la acción \texttt{Batalla}, y construí el SCD de los PNJ's.

Es a partir de este momento cuando decidimos que queremos una aplicación altamente configurable, y es en este apartado donde he realizado mi principal aportación al proyecto.

Lo primero que intente fue tratar de hacer a los personajes lo mas configurables posibles. Para ello, debí crear una nueva estructura para los propios personajes, a través de una superclase y el uso de la herencia (el resultado final de esta arquitectura se puede ver en la Figura \ref{fig:DCPersonajes}) . Para ello, fue necesario crear las clases \texttt{Protagonista} y \texttt{Antagonista}, de la misma manera que tuve que rehacer \texttt{PNJ}, de manera que todas las clases pudiesen interpretar correctamente los datos de la superclase.
Estos cambios en la estructura me permitieron configurar los personajes de una manera más eficaz, de manera que les añadí atributos para favorecer la narración, como por ejemplo en un antagonista su \texttt{sexo} o su \texttt{especie}. Esto, junto al atributo \texttt{clase}, me permitía configurar los detalles de un antagonista, de manera que con un mismo arquetipo de configuración conseguía resultados muy distintos, como por ejemplo los que muestro en el Cuadro \ref{ejemploantagonistasXML}.

\lstset{frameround=fttt}
\begin{lstlisting}[basicstyle=\scriptsize,frame=trBL,caption={Ejemplo de código de creacion de antagonistas},label=ejemploantagonistasXML]

<Actores>
	<monstruo nombre="Smaug" clase="Secuestrador" 
		especie="Dragon" sexo="M"/>
	<monstruo nombre="Florecilla" clase="Secuestrador"
		 especie="Dragon" sexo="F"/>
	<monstruo nombre="Scar" clase="Secuestrador"
		 especie="Tigre" sexo="M"/>
</Actores>
\end{lstlisting}  

De esta manera, puedo conseguir al dragón Smaug, la dragona Florecilla o el tigre Scar, y todos actuaran como un antagonista secuestrador. La gracia de esta implementación reside en que la historia cambia totalmente cuando se narra, gracias a los atributos nuevos y la abstracción con la que se han construido las clases de personajes.

Cuando implementé estos cambios, se hizo patente la necesidad de cambiar los archivos XML y los SCD que los cargaban. De esta manera, configuré correctamente el SCD, lo cual provocó que se debía cambiar la manera en la que se iniciaba cada personaje de manera individual y tuvé que realizar los cambios oportunos.


Mi siguiente trabajo fue cambiar el mapa, tratando de permitir al usuario modificarlo a su gusto. Al rehacer el mapa de la manera mas configurable posible decidí darle tipos a las localizaciones, consultable en el Capítulo \ref{cap:Mapa:ClaseMapaLocalizacion}, de manera que los personajes se situaban al crearse según su clase en estos distintos tipos, tal y como se muestra en la Figura \ref{cap:Mapa:LocalizacionesAleatoriasSegunClase}. Todas estas características están implementadas en la interfaz \texttt{Vocabulario}, donde se definen los diferentes tipos de localizaciones que se pueden tener, así como en la clase \texttt{Mitologia} donde se especifica la relación entre cada clase y su localización.
Para conseguir satisfactoriamente este cambio, tuve que crear una arquitectura funcional para el mismo, creando la clase localización para poder interpretar correctamente el mapa y revisando la conexión entre la clase \texttt{Mapa} y el \texttt{Agente Mundo}, de manera que este agente pudiese interpretar correctamente el mapa (el diagrama de esta arquitectura es consultable en la figura \ref{fig:DCMapa}). 

Lo único que quedaba sin ser configurable en la aplicación eran las razas, así que me puse con ello. Originalmente, las razas se cargaban directamente desde un enumerado implementado dentro de la aplicación, de manera que para hacerlas configurables tuve que crear su propia clase, asi como modificar su XML y crear un SCD acorde a él. De igual manera, tuve que modificar la clase \texttt{Protagonista} para que las razas fuesen cargadas correctamente y hacer que esta clase pudiese interactuar correctamente con la clase raza, conseguido a través de su vínculo común con el \texttt{Agente Mundo}. 

Por último realice la implementación del \texttt{Ayudante del Héroe}. Para crear este agente, debí crear su clase, así como los métodos necesarios para su ejecución y crear los comportamientos que necesitaba, en este caso \texttt{ConvertirseEnSabio}. Sin embargo, la parte mas difícil de esta implementación fue conseguir que el mundo avisase correctamente al \texttt{ayudante} cuando se producía un encuentro entre un \texttt{aspirante a heroe} y un \texttt{ladron}. Para ello, debí modificar el \texttt{Agente Mundo}, de manera que tomando como ejemplo el encuentro entre el \texttt{aspirante} y el \texttt{emboscador}, realicé uno parecido entre el \texttt{aspirante a heroe} y el \texttt{ladron} llamado \texttt{EncuentroLadron}, controlando como interactuaban estos agentes entre ellos, buscando en las páginas amarillas de JADE y mediante el intercambio de mensajes. Una vez se producía el encuentro entre estos dos agentes, el \texttt{Agente Mundo} se encargaba de avisar a los ayudantes a través del método \texttt{AcudeAyudante}, tal y como se especifica en el capitulo\ref{cap:Personajes:Aspirante}, donde nuevamente controlé el intercambio de mensajes entre estos agentes hasta que finalmente el ayudante llegaba. Por último, solo me quedaba realizar correctamente la planificación del ayudante, y junto con la ayuda de Oscar, conseguí acabarla satisfactoriamente.

Para finalizar, me comprometí en gran medida con el desarrollo y corrección de la memoria. En concreto, los capítulos que he desarrollado han sido: Resumen y su traducción, Introducción y su traducción, Primeros Pasos, Mapa, Personajes (en concreto, la clase Personaje, personajes, antagonistas, PNJ's, atributos y razas) y Conclusiones y su traducción.

\section{Trabajo realizado por Samuel Rodríguez Oliva}
En primer lugar para poder empezar a hablar de mi aportación al proyecto que se ha estado describiendo a lo largo de esta memoria hay que empezar por el trabajo de documentación que he ido realizando.
Al no haber trabajado previamente con Agentes ni con planificadores, le pedí al tutor toda la información posible sobre el proyecto del cual íbamos a tener partir.
Aparte de la información del proyecto también nos pasó cinco documentos que trataban sobre Agentes, Sistemas Multi-Agentes y generadores de historias con Agentes, referencias donde ver como instalar y trabajar con JADE y una web (http://icaps-conference.org/index.php/Main/Competitions), en la cual se podían ver proyectos que han participado en competiciones, para buscar información sobre planificación en IA en general y PDDL en particular.
Toda esta información sirvió para focalizar la investigación en ciertos puntos que establecerían algunas base del proyecto.
A partir de aquí comencé a leer artículos relacionados con la generación de historias y la web http://nil.fdi.ucm.es/ fue de gran ayuda al ser donde encontré la mayoría de ellos.
Esto me permitió conocer sistemas previos de generación de historias lo que me fue de gran ayuda para conocer aspectos en los cuales ya se habían trabajado previamente además de observar y adaptar nuevas ideas que integrar en el proyecto.
Para conocer los sistemas con mayor relevancia dentro del campo de la generación de historias automáticas es mejor ver el Capítulo \ref{cap:EstadoDeLaCuestion:Narrativa}.
 
Durante las primeras semanas fue crucial realizar reuniones cada dos semanas ya que en ellas Gonzalo, y durante todo el tiempo que le fue posible Raquel, nos solventaban las dudas que habían ido surgiendo de una reunión a otra al ir avanzando y trabajando sobre el proyecto.
Después de la resolución de dudas, se realizaba un \textit{brainstorming} sobre las funciones que queríamos que realizase nuestro sistema.
Aunque no todas las ideas lanzadas en estas reuniones nos servían o podías ser implementas si recogimos algunas que han servido como pilares para el sistema.
Estos pilares están recogidos como los objetivos que hemos querido conseguir y de los cuales se habla detalladamente en el Capitulo de \ref{cap:Objetivos}. 

Como se ve en el Capítulo \ref{cap:PrimerosPasos} estábamos bloqueados con la implementación ya que nos atamos, al principio, con el sistema de nuestros compañeros.
En estos primeros pasos trabajé en como hacer que la princesa no fuese un Agente objeto y ayudé a mis compañeros para intentar lograr que el caballero pudiese tener múltiples objetivos.
Al fracasar en estos objetivos decidimos partir de un sistema realizado por nosotros desde el principio y así no tener limitaciones que no fuesen impuestas por nosotros mismos.
En este punto repartimos el trabajo para avanzar de forma más eficiente y es aquí donde yo empecé a trabajar con el sistema finalmente desarrollado.

En primer lugar mi trabajo se centro en la inclusión de los objetos en el sistema para que los personajes pudiesen interactuar con ellos afectando el transcurso de la historia y dando lugar a nuevas variantes.
Para ver más detalladamente este apartado consultar el Capítulo \ref{cap:Objetos}.
Ya que para algunos objetos, los clave(Capítulo \ref{cap:Objetos:Clave}), necesitaba trabajar con la parte de planificación, hubo momentos en los que trabajamos conjuntamente Óscar y yo, él ayudándome con la integración de los objetos en el planificador y yo a él con el archivo de dominio del planificador en la creación de algunas acciones atómicas de los personajes. 
A la vez que trabajaba con los objetos también estaba participando en la realización de conceptos, tal cual se encuentran implementados actualmente, como los atributos y razas, dando lógica a todo este nuevo apartado.
Además también participe activamente en la implementación del árbol de herencia de clases de los personajes.

Una vez implementado la primera versión estable de los objetos, mi trabajo se centró enteramente al apartado narrativo del sistema.
Dentro de este apartado es importante explicar que el porqué no tiene un Capitulo propio dentro de la memoria y es que  he creído conveniente que la mejor opción para explicar el tema sería en un apartado dentro del Capítulo de Personajes(\ref{cap:Personajes:Narrativa}), debido a que las historias generadas con nuestro sistema están centradas en los personajes y son estos los encargados de saber para cada acción que realizan la frase o frases correspondientes que pueden decir durante la consecución de sus respectivos objetivos.

En los trabajos que acabo de describir también me he encargado de la realización de su correspondiente SCD.
Es por ello que esto me ha servido para poder estar encargado de la realización de las nuevas configuraciones para los archivos XML y de imágenes con los que trabaja el sistema, y con ello poder probar el potencial de configuración y cambio de entornos de nuestro sistema.
Para ver una explicación más detallada y algún ejemplo de historias generadas es conveniente mirar en el Capítulo \ref{cap:Simulaciones}.
El ir probando estas diferentes configuraciones también ha servido para haberme dedicado al control de errores y haber ido solventando los problemas y errores que se encontraban en las últimas versiones del sistema.
\newpage
De forma paralela a la implementación del sistema, en primer lugar me encargué de transferir al documento que empezamos a generar en \emph{LaTeX} toda la información que hasta el momento habíamos ido recogiendo tanto yo como mis compañeros.
Aquellos aspectos sobre los cuales he escrito han sido referentes principalmente a la parte de Narrativa Computacional dentro del Estado de la Cuestión, al Capítulo sobre los objetos así como al Capítulo de Simulaciones realizadas y al aparatado del Sistema Narrativo de los Personajes, que son en los que se ha centrado mi trabajo de implementación.
También he participado de forma importante en el desarrollo del Resumen, Introducción y Trabajo Futuro, además de en el replanteamiento y la reestructuración de los Capítulos Primeros Pasos y Personajes.
Finamente mis últimos pasos en la realización de esta memoria se han enfocado en la corrección, de la forma más eficiente posible, de todos los Capítulos, en especial sobre los que no había trabajado, además de una correcta colocación de imágenes, textos y códigos que se han servido tanto de ejemplo como de apoyo durante la descripción del proyecto en la redacción de este documento.

\section{Trabajo realizado por Oscar David Vásquez Peraza}

Una vez que se realizaron los primeros procesos de \textit{brainstorming}, quedó bastante claro que las primeras aproximaciones que se debían hacer era familiarizarse con JADE, el lenguaje PDDL, y estudiar al fondo el sistema generador anterior.

En estas primeras fases, se trató de incorporar una serie de variaciones y nuevas funciones en el sistema base, sin mucho éxito. Entonces empecé a crear sistemas simples usando JADE que ayudarían al resto de compañeros también a entender el funcionamiento de los agentes con mayor facilidad. Una vez hecho todo esto procedí con la reimplementación del sistema anterior parte por parte para poder tener una estructura limpia que nos permitiese realizar la implementación de las nuevas funciones. De igual manera, he sido responsable de crear y mantener la consistencia de los repositorios.


Tras varias discusiones sobre las diferentes capas que iban a componer el sistema, se empieza a hacer el montaje del nuevo sistema. Una de las primeras funciones que se incorpora es la interfaz gráfica, puesto que nos permitiría interactuar con el sistema de una forma más cómoda. De primeras, la función principal de la interfaz gráfica fue disponer de una única ventana que tuviese un área de texto que sustituiría a la salida estándar de consola que estaba usando la aplicación por defecto. A medida que se fue avanzando, se estudiaron diferentes diseños para la interfaz, de los cuales el que se usa trata de ser un diseño limpio y sencillo que permita centrar la atención en el cuadro central donde se muestra la historia y minimizar otros componentes extras que puedan distraer al usuario de la historia que se está generando.

El diseño e implementación de nuevos tipos de personajes requería no solo un buen manejo de JADE, sino que tambíen del lenguaje PDDL puesto éste es quién declara y especifica las acciones que usan los personajes y que en función de las acciones que realicen serán un tipo de personaje en la historia. Todo esto lleva a empezar a diseñar el conjunto de instrucciones necesarias para disponer de un sistema multiobjetivos.

La solución más sencilla con la que dimos fué la de permitir a los archivos de configuración disponer de varias entradas para las etiquetas XML e implementar del lado de los SCD una carga aleatoria de las mismas. Esto obliga a que la implementación de cada tipo de personaje sea lo suficientemente robusta como para aceptar distintos comportamientos cuya ejecución vendría determinada por la secuencia de acciones que sería devuelta por el planificador de la aplicación. En este momento nos damos cuenta de que en lugar de crear un agente en concreto que solo realizaba cierto tipos de acciones, se puede hacer que el agente sea capaz de ejercer ciertos roles en función del tipo de objetivo que haya elegido realizar.

Así es como se empieza a hacer la ampliación del dominio pddl y crear nuevas acciones, con nuevos efectos sobre los personajes y que algunos servirían para personajes específicos y otras acciones más generales. Esto obliga ampliar el código para que cada personaje sea capaz de procesar las nuevas instrucciones que va recibiendo del planificador así como también aumentó drásticamente el número de variables de control en el sistema.

A la vista de la nueva magnitud que el sistema estaba tomando, fue necesario modificar el agente Mundo y la forma en la que manejaba cierta información. Debido a ciertas características del lenguaje pddl, la información que recibe cada personaje para generar su fichero de problema empezó a verse en la necesidad de ser filtrada, puesto que el tamaño de los archivos ha aumentado porque recogen toda la nueva información. Gran parte de esta información era irrelevante para cada personaje, o mejor dicho, a cada personaje sólo le interesa conocer cierta información, así que generar un archivo de problema pddl específico para cada personaje se convirtió en algo a implementar con alto nivel de urgencia.

El montaje del nuevo sistema permitía que implementar una serie nuevos personajes fuese más sencillo, empezando a implementar personajes como el emboscador, el asesino, el ladrón, la planificación de la víctima , así como darle la posibilidad de escapar por cuenta propia de su secuestrador.

Al implementar a estos personajes, crear y diseñar la forma en la que se dispararían eventos entre personajes que estuviesen funcionando de forma paralela se hace inmediatamente necesario para que estos personajes interactúen correctamente, con lo cuál me hago cargo de asegurarme que el agente Mundo sea capaz de manejar y controlar los eventos. A modo general, la mayor parte de mi trabajo está centrado en el estudio y diseño del funcionamiento y la lógica del sistema.

Respecto a la documentación, al ser el único integrante del grupo que tenía experiencia previa en \LaTeX, me encargué al principio de hacer el montaje y pruebas de la documentación sobre la plantilla \texis\, de igual manera enseñar a mis compañeros la sintaxis e instrucciones básicas que usaríamos con mayor frecuencia en la redacción de éste documento.

En la redacción, los capítulos de los cuales he tenido mayor responsabilidad han sido: Estado de la Cuestión (a excepción de la narrativa), Objetivos, Arquitectura y Trabajo Futuro. De igual manera al resto de compañeros, responsable de la revisión y corrección sistemática de cada uno de los diferentes capítulos de este documento.